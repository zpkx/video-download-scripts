# è§†é¢‘ä¸‹è½½å™¨ä½¿ç”¨è¯´æ˜

ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§ä¸”çµæ´»çš„è§†é¢‘ä¸‹è½½å·¥å…·ï¼ŒåŸºäº yt-dlp æ„å»ºï¼Œæ”¯æŒ YAML é…ç½®ã€åˆ†ç±»ä¸‹è½½å’Œè‡ªåŠ¨é…ç½®æ£€æµ‹ã€‚

## âœ¨ ä¸»è¦åŠŸèƒ½

- **YAML é…ç½®æ”¯æŒ**ï¼šä½¿ç”¨æ˜“äºç¼–è¾‘çš„ YAML æ–‡ä»¶è¿›è¡Œé…ç½®
- **è‡ªåŠ¨é…ç½®æ£€æµ‹**ï¼šè‡ªåŠ¨æ£€æµ‹å¹¶åŠ è½½ `config.yaml` é…ç½®æ–‡ä»¶
- **åˆ†ç±»ä¸‹è½½ç®¡ç†**ï¼šå°†ä¸‹è½½å†…å®¹æŒ‰ç±»åˆ«ç»„ç»‡ï¼Œä½¿ç”¨ç‹¬ç«‹çš„è¾“å‡ºç›®å½•
- **å¤šç§è¾“å…¥æ–¹å¼**ï¼šæ”¯æŒ YAML é…ç½®æ–‡ä»¶å’Œçº¯æ–‡æœ¬ URL åˆ—è¡¨
- **ä»…ä¿¡æ¯æ¨¡å¼**ï¼šä»…æå–è§†é¢‘å…ƒæ•°æ®ï¼Œä¸è¿›è¡Œä¸‹è½½
- **å»¶è¿Ÿç®¡ç†**ï¼šå¯é…ç½®ä¸‹è½½é—´éš”ï¼Œé¿å…è§¦å‘é€Ÿç‡é™åˆ¶
- **Cookie æ”¯æŒ**ï¼šè‡ªåŠ¨æ£€æµ‹ Cookie æ–‡ä»¶ï¼Œæ”¯æŒéœ€è¦ç™»å½•çš„å†…å®¹
- **è¯¦ç»†æ—¥å¿—è®°å½•**ï¼šå®Œæ•´çš„ä¸‹è½½è¿›åº¦å’Œé”™è¯¯æ—¥å¿—

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å®‰è£…

1. å…‹éš†æˆ–ä¸‹è½½æ­¤é¡¹ç›®
2. å®‰è£…ä¾èµ–ï¼š
   ```bash
   pip install -r requirements.txt
   ```

### åŸºæœ¬ä½¿ç”¨

```bash
# ä¸‹è½½å•ä¸ªè§†é¢‘
python video_downloader.py "https://example.com/video"

# ä» YAML é…ç½®æ–‡ä»¶ä¸‹è½½
python video_downloader.py --file urls.yaml

# ä»çº¯æ–‡æœ¬æ–‡ä»¶ä¸‹è½½
python video_downloader.py --file urls.txt

# ä»…è·å–è§†é¢‘ä¿¡æ¯ï¼ˆä¸ä¸‹è½½ï¼‰
python video_downloader.py --info-only "https://example.com/video"
```

## ğŸ“ é…ç½®è¯´æ˜

### è‡ªåŠ¨é…ç½®åŠŸèƒ½

è„šæœ¬ä¼šè‡ªåŠ¨åœ¨å½“å‰ç›®å½•æŸ¥æ‰¾ `config.yaml` æˆ– `config.yml` æ–‡ä»¶ï¼Œå¹¶ä»ä¸­åŠ è½½ yt-dlp é€‰é¡¹ã€‚æ— éœ€æ‰‹åŠ¨æŒ‡å®šé…ç½®æ–‡ä»¶ï¼

### YAML é…ç½®æ ¼å¼

#### URL é…ç½®æ–‡ä»¶ (`urls.yaml`)

```yaml
# å…¨å±€è®¾ç½®ï¼Œåº”ç”¨åˆ°æ‰€æœ‰åˆ†ç±»
global_settings:
  default_quality: "best"
  default_delay_range: [5, 10]
  default_output_path: "./downloads"

# åˆ†ç±»å®šä¹‰
categories:
  çºªå½•ç‰‡:
    output_path: "./downloads/çºªå½•ç‰‡"
    quality: "1080p"
    urls:
      - https://example.com/doc1
      - https://example.com/doc2
  
  æ•™ç¨‹è§†é¢‘:
    output_path: "./downloads/æ•™ç¨‹"
    urls:
      - https://example.com/tutorial1
      - https://example.com/tutorial2
  
  åŠ¨æ¼«ç•ªå‰§:
    output_path: "./downloads/åŠ¨æ¼«"
    subtitle_langs: ["zh-CN", "zh-TW"]
    urls:
      - https://example.com/anime1
      - https://example.com/anime2
```

#### yt-dlp é€‰é¡¹é…ç½® (`config.yaml`)

```yaml
# è§†é¢‘æ ¼å¼å’Œè´¨é‡è®¾ç½®
format: "bestvideo[height>=1080]+bestaudio/best"
merge_output_format: "mp4"

# å…ƒæ•°æ®å’Œå­—å¹•è®¾ç½®
writeinfojson: true
writesubtitles: true
writeautomaticsub: true
subtitleslangs: ["zh-CN", "zh-TW", "en"]
embed_subs: true
writethumbnail: true

# é”™è¯¯å¤„ç†è®¾ç½®
ignoreerrors: true
retries: 3
fragment_retries: 3
```

## ğŸ“– å‘½ä»¤è¡Œé€‰é¡¹

```
ä½¿ç”¨æ–¹æ³•: video_downloader.py [-h] [-f FILE] [-o OUTPUT] 
                              [-q {low,medium,high,best}] [--delay-seconds DELAY_SECONDS]
                              [--delay-max DELAY_MAX] [--info-only] [--config CONFIG]
                              [urls ...]

ä½ç½®å‚æ•°:
  urls                  è¦ä¸‹è½½çš„è§†é¢‘ URL

å¯é€‰å‚æ•°:
  -h, --help            æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯
  -f FILE, --file FILE  YAML é…ç½®æ–‡ä»¶æˆ–çº¯æ–‡æœ¬ URL æ–‡ä»¶
  -o OUTPUT, --output OUTPUT
                        è¾“å‡ºç›®å½•ï¼ˆé»˜è®¤ï¼š./downloadsï¼‰
  -q {low,medium,high,best}, --quality {low,medium,high,best}
                        è§†é¢‘è´¨é‡ï¼ˆé»˜è®¤ï¼šbestï¼‰
  --delay-seconds DELAY_SECONDS
                        ä¸‹è½½é—´æœ€å°å»¶è¿Ÿç§’æ•°ï¼ˆé»˜è®¤ï¼š5ï¼‰
  --delay-max DELAY_MAX
                        ä¸‹è½½é—´æœ€å¤§å»¶è¿Ÿç§’æ•°ï¼ˆé»˜è®¤ï¼š15ï¼‰
  --info-only           ä»…æå–è§†é¢‘ä¿¡æ¯ï¼ˆä¸ä¸‹è½½ï¼‰
  --config CONFIG       yt-dlp é€‰é¡¹çš„ YAML é…ç½®æ–‡ä»¶ï¼ˆè‡ªåŠ¨æ£€æµ‹ config.yamlï¼‰
```

## ğŸ¯ ä½¿ç”¨ç¤ºä¾‹

### åˆ†ç±»ä¸‹è½½

åˆ›å»º `urls.yaml` æ–‡ä»¶ï¼š
```yaml
categories:
  åŠ¨æ¼«:
    output_path: "./downloads/åŠ¨æ¼«"
    urls:
      - https://www.bilibili.com/bangumi/play/ep1234567
      - https://www.bilibili.com/bangumi/play/ep1234568
  
  ç”µå½±:
    output_path: "./downloads/ç”µå½±"
    quality: "best"
    urls:
      - https://example.com/movie1
```

è¿è¡Œä¸‹è½½å™¨ï¼š
```bash
python video_downloader.py --file urls.yaml
```

### è‡ªå®šä¹‰ yt-dlp é…ç½®

åˆ›å»º `config.yaml` æ–‡ä»¶ï¼Œè®¾ç½®æ‚¨å–œæ¬¢çš„ yt-dlp é€‰é¡¹ï¼š
```yaml
format: "bestvideo[height<=720]+bestaudio/best"
writesubtitles: true
subtitleslangs: ["zh-CN"]
```

è„šæœ¬ä¼šè‡ªåŠ¨åŠ è½½æ­¤é…ç½®ï¼

### ä»…ä¿¡æ¯æ¨¡å¼

æå–å…ƒæ•°æ®è€Œä¸ä¸‹è½½ï¼š
```bash
python video_downloader.py --info-only "https://www.bilibili.com/video/BV1234567890"
```

### å¤šä¸ª URL

```bash
python video_downloader.py "url1" "url2" "url3" --output ./æˆ‘çš„ä¸‹è½½
```

## ğŸ—‚ï¸ æ–‡ä»¶ç»“æ„

```
video-download-scripts/
â”œâ”€â”€ video_downloader.py     # ä¸»è„šæœ¬
â”œâ”€â”€ requirements.txt        # Python ä¾èµ–
â”œâ”€â”€ config.yaml            # yt-dlp é€‰é¡¹ï¼ˆè‡ªåŠ¨åŠ è½½ï¼‰
â”œâ”€â”€ urls.yaml              # åˆ†ç±» URL é…ç½®
â”œâ”€â”€ cookies.txt            # æµè§ˆå™¨ Cookieï¼ˆå¯é€‰ï¼‰
â”œâ”€â”€ downloads/             # é»˜è®¤ä¸‹è½½ç›®å½•
â””â”€â”€ video_download.log     # ä¸‹è½½æ—¥å¿—
```

## ğŸ”§ é…ç½®æ–‡ä»¶è¯´æ˜

### æ”¯æŒçš„ Cookie æ–‡ä»¶
è„šæœ¬ä¼šè‡ªåŠ¨ä»ä»¥ä¸‹ä½ç½®æ£€æµ‹ Cookieï¼š
- `cookies.txt`
- `www.bilibili.com_cookies.txt`
- `~/cookies.txt`
- `~/Downloads/cookies.txt`

### å…¼å®¹æ€§è¯´æ˜
- ä»æ”¯æŒçº¯æ–‡æœ¬ URL æ–‡ä»¶ï¼ˆ`.txt`ï¼‰
- ç°æœ‰å·¥ä½œæµç¨‹å°†ç»§ç»­æ­£å¸¸å·¥ä½œ

## ğŸ“‹ è´¨é‡é€‰é¡¹

- **low**ï¼šä½è´¨é‡ï¼Œæ–‡ä»¶è¾ƒå°
- **medium**ï¼šå¹³è¡¡è´¨é‡å’Œå¤§å°
- **high**ï¼šé«˜è´¨é‡
- **best**ï¼šæœ€ä½³å¯ç”¨è´¨é‡ï¼ˆé»˜è®¤ï¼‰

## ğŸ› ï¸ é«˜çº§åŠŸèƒ½

### å»¶è¿Ÿé…ç½®
æ§åˆ¶ä¸‹è½½é€Ÿåº¦ä»¥é¿å…é€Ÿç‡é™åˆ¶ï¼š
```bash
# 5-15 ç§’éšæœºå»¶è¿Ÿ
python video_downloader.py --delay-seconds 5 --delay-max 15 --file urls.yaml
```

### è‡ªå®šä¹‰è¾“å‡ºç›®å½•
```bash
python video_downloader.py --output ./è‡ªå®šä¹‰æ–‡ä»¶å¤¹ "https://example.com/video"
```

### å¤šä¸ªé…ç½®æ–‡ä»¶
```bash
# ä½¿ç”¨ç‰¹å®šé…ç½®æ–‡ä»¶
python video_downloader.py --config my_config.yaml --file urls.yaml
```

## ğŸ“ æ—¥å¿—è®°å½•

æ‰€æœ‰ä¸‹è½½æ´»åŠ¨éƒ½ä¼šè®°å½•åˆ° `video_download.log` æ–‡ä»¶ä¸­ï¼ŒåŒ…å«æ—¶é—´æˆ³å’Œè¯¦ç»†ä¿¡æ¯ï¼š
- ä¸‹è½½è¿›åº¦
- é”™è¯¯å’Œè­¦å‘Š
- é…ç½®åŠ è½½æƒ…å†µ
- æ–‡ä»¶æ£€æµ‹ä¿¡æ¯

## ğŸ¨ åˆ†ç±»é…ç½®é«˜çº§é€‰é¡¹

åœ¨ `urls.yaml` ä¸­å¯ä»¥ä¸ºæ¯ä¸ªåˆ†ç±»è®¾ç½®ç‰¹æ®Šé€‰é¡¹ï¼š

```yaml
categories:
  éŸ³ä¹:
    output_path: "./downloads/éŸ³ä¹"
    extract_audio: true          # ä»…æå–éŸ³é¢‘
    audio_format: "mp3"          # éŸ³é¢‘æ ¼å¼
    urls:
      - https://example.com/music1

  é«˜æ¸…è§†é¢‘:
    output_path: "./downloads/é«˜æ¸…"
    quality: "best"
    subtitle_langs: ["zh-CN"]    # å­—å¹•è¯­è¨€
    embed_thumbnail: true        # åµŒå…¥ç¼©ç•¥å›¾
    urls:
      - https://example.com/hd1
```

## ğŸš¨ å¸¸è§é—®é¢˜è§£å†³

### å¸¸è§é—®é¢˜

1. **æ²¡æœ‰è§†é¢‘ä¸‹è½½**ï¼šæ£€æŸ¥æ˜¯å¦å­˜åœ¨ cookies.txt æ–‡ä»¶ä»¥è®¿é—®éœ€è¦ç™»å½•çš„å†…å®¹
2. **é…ç½®æœªåŠ è½½**ï¼šç¡®ä¿ `config.yaml` ä¸è„šæœ¬åœ¨åŒä¸€ç›®å½•
3. **ç½‘ç»œé”™è¯¯**ï¼šä½¿ç”¨ `--delay-seconds` å¢åŠ ä¸‹è½½é—´éš”

### è°ƒè¯•æ¨¡å¼

æŸ¥çœ‹è¯¦ç»†è°ƒè¯•ä¿¡æ¯ï¼Œè¯·æ£€æŸ¥ `video_download.log` æ–‡ä»¶æˆ–è¿è¡Œæ—¶æŸ¥çœ‹è¯¦ç»†è¾“å‡ºã€‚

## ğŸ“„ Bç«™ä½¿ç”¨è¯´æ˜

### Cookie è·å–æ–¹æ³•
1. åœ¨æµè§ˆå™¨ä¸­ç™»å½• Bç«™
2. ä½¿ç”¨æµè§ˆå™¨æ‰©å±•ï¼ˆå¦‚ Get cookies.txtï¼‰å¯¼å‡º Cookie
3. å°†æ–‡ä»¶ä¿å­˜ä¸º `cookies.txt` æˆ– `www.bilibili.com_cookies.txt`

### Bç«™é“¾æ¥æ ¼å¼
æ”¯æŒä»¥ä¸‹æ ¼å¼ï¼š
- `https://www.bilibili.com/video/BV1234567890`
- `https://www.bilibili.com/bangumi/play/ep1234567`
- `https://www.bilibili.com/bangumi/play/ss12345`

## âš ï¸ ä½¿ç”¨æ³¨æ„äº‹é¡¹

- è¯·éµå®ˆå†…å®¹åˆ›ä½œè€…çš„ç‰ˆæƒå’Œå¹³å°æœåŠ¡æ¡æ¬¾
- åˆç†ä½¿ç”¨ä¸‹è½½åŠŸèƒ½ï¼Œä¸è¦ç»™æœåŠ¡å™¨é€ æˆè¿‡å¤§å‹åŠ›
- å»ºè®®è®¾ç½®é€‚å½“çš„ä¸‹è½½å»¶è¿Ÿ

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤é—®é¢˜ã€åŠŸèƒ½è¯·æ±‚æˆ–æ”¹è¿›å»ºè®®æ¥å®Œå–„è¿™ä¸ªå·¥å…·ï¼
